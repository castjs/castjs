"use strict";function _instanceof(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function _classCallCheck(e,t){if(!_instanceof(e,t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var Castjs=function(){function s(e,t){var r=this;if(_classCallCheck(this,s),!window.chrome)return console.warn("Castjs: Casting is not supported in this browser");if(e&&-1===e.indexOf(["tab_and_origin_scoped","origin_scoped","page_scoped"])){var i=t;t=e,e=i}this.events={},this.receiver=e||"CC1AD845",this.joinpolicy=t||"tab_and_origin_scoped",this.available=!1,this.player=null,this.controller=null,this.session=null,this.device=null,this.source=null,this.title=null,this.description=null,this.poster=null,this.subtitles=[],this.volumeLevel=1,this.muted=!1,this.paused=!1,this.time=0,this.timePretty="00:00:00",this.duration=0,this.durationPretty="00:00:00",this.progress=0,this.state="disconnected";var n=setInterval(function(){window.chrome.cast&&window.chrome.cast.isAvailable&&(clearInterval(n),cast.framework.CastContext.getInstance().setOptions({receiverApplicationId:r.receiver,autoJoinPolicy:r.joinpolicy,language:r.language,resumeSavedSession:r.resume}),r.player=new cast.framework.RemotePlayer,r.controller=new cast.framework.RemotePlayerController(r.player),r.controller.addEventListener("isConnectedChanged",r.controller_isConnectedChanged.bind(r)),r.controller.addEventListener("currentTimeChanged",r.controller_currentTimeChanged.bind(r)),r.controller.addEventListener("durationChanged",r.controller_durationChanged.bind(r)),r.controller.addEventListener("volumeLevelChanged",r.controller_volumeLevelChanged.bind(r)),r.controller.addEventListener("isMutedChanged",r.controller_isMutedChanged.bind(r)),r.controller.addEventListener("isPausedChanged",r.controller_isPausedChanged.bind(r)),r.controller.addEventListener("playerStateChanged",r.controller_playerStateChanged.bind(r)),r.available=!0,r.trigger("available"))},250)}function e(e){return t.apply(this,arguments)}var t;return _createClass(s,[{key:"controller_isConnectedChanged",value:function(){var r=this;setTimeout(function(){if(r.session=r.player.isConnected,r.session&&r.player.isMediaLoaded){for(var e in r.device=cast.framework.CastContext.getInstance().getCurrentSession().getCastDevice().friendlyName,r.source=r.player.mediaInfo.contentId,r.title=r.player.title||null,r.description=r.player.mediaInfo.metadata.subtitle||null,r.poster=r.player.imageUrl||null,r.subtitles=[],r.volumeLevel=r.player.volumeLevel,r.muted=r.player.isMuted,r.paused=r.player.isPaused,r.time=r.player.currentTime,r.timePretty=r.controller.getFormattedTime(r.player.currentTime),r.duration=r.player.duration,r.durationPretty=r.controller.getFormattedTime(r.player.duration),r.progress=r.controller.getSeekPosition(r.player.currentTime,r.player.duration),r.state=r.player.playerState.toLowerCase(),r.player.mediaInfo.tracks)"TEXT"===r.player.mediaInfo.tracks[e].type&&r.subtitles.push({label:r.player.mediaInfo.tracks[e].name,source:r.player.mediaInfo.tracks[e].trackContentId});var t=cast.framework.CastContext.getInstance().getCurrentSession().getSessionObj().media[0].activeTrackIds;t.length&&r.subtitles[t[0]]&&(r.subtitles[t[0]].active=!0),r.trigger("session")}})}},{key:"controller_currentTimeChanged",value:function(){this.time=this.player.currentTime,this.duration=this.player.duration,this.progress=this.controller.getSeekPosition(this.time,this.duration),this.timePretty=this.controller.getFormattedTime(this.time),this.durationPretty=this.controller.getFormattedTime(this.duration),this.trigger("timeupdate")}},{key:"controller_durationChanged",value:function(){this.duration=this.player.duration}},{key:"controller_volumeLevelChanged",value:function(){this.volumeLevel=this.player.volumeLevel,this.trigger("volumechange")}},{key:"controller_isMutedChanged",value:function(){this.muted=this.player.isMuted,this.trigger("muted")}},{key:"controller_isPausedChanged",value:function(){this.paused=this.player.isPaused,this.trigger("paused")}},{key:"controller_playerStateChanged",value:function(){this.state=this.player.playerState.toLowerCase(),"idle"===this.state&&this.trigger("ended"),this.trigger("statechange")}},{key:"on",value:function(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}},{key:"off",value:function(e,t){if(!e)return this.events={};if(this.events[e]){if(void 0===t)return this.events[e]=[];for(var r in this.events[e])if(this.events[e][r]===t){this.events[e].splice(r,1);break}}}},{key:"trigger",value:function(e){var t=Array.prototype.slice.call(arguments,1);for(var r in this.events[e])this.events[e][r].apply(this,t);for(var r in this.events.any)this.events.any[r].apply(this,[e])}},{key:"cast",value:(t=function(e){var s=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!e)return this.trigger("error","No media source specified.");for(var r in t.source=e,t)t.hasOwnProperty(r)&&(this[r]=t[r]);cast.framework.CastContext.getInstance().requestSession().then(function(){if(!cast.framework.CastContext.getInstance().getCurrentSession())return s.trigger("error","Could not connect with the cast device");var e=new chrome.cast.media.MediaInfo(s.source);if(e.metadata=new chrome.cast.media.GenericMediaMetadata,s.subtitles.length){e.textTrackStyle=new chrome.cast.media.TextTrackStyle,e.textTrackStyle.backgroundColor="#00000000",e.textTrackStyle.edgeColor="#00000016",e.textTrackStyle.edgeType=chrome.cast.media.TextTrackEdgeType.DROP_SHADOW,e.textTrackStyle.fontFamily=chrome.cast.media.TextTrackFontGenericFamily.CASUAL,e.textTrackStyle.fontScale=1,e.textTrackStyle.foregroundColor="#FFFFFF";var t=[];for(var r in s.subtitles){var i=new chrome.cast.media.Track(r,chrome.cast.media.TrackType.TEXT);i.name=s.subtitles[r].label,i.subtype=chrome.cast.media.TextTrackType.CAPTIONS,i.trackContentId=s.subtitles[r].source,i.trackContentType="text/vtt",i.trackId=parseInt(r),i.type=chrome.cast.media.TrackType.TEXT,t.push(i)}e.tracks=t}e.metadata.images=[new chrome.cast.Image(s.poster)],e.metadata.title=s.title,e.metadata.subtitle=s.description;var n=new chrome.cast.media.LoadRequest(e);if(n.currentTime=s.time,n.autoplay=!s.paused,s.subtitles.length)for(var r in s.subtitles)if(s.subtitles[r].active){n.activeTrackIds=[parseInt(r)];break}cast.framework.CastContext.getInstance().getCurrentSession().loadMedia(n).then(function(){return s.device=cast.framework.CastContext.getInstance().getCurrentSession().getCastDevice().friendlyName,s.trigger("session"),s},function(e){return s.trigger("error",e),s})},function(e){return s.trigger("error",e),s})},e.toString=function(){return t.toString()},e)},{key:"seek",value:function(e,t){return t&&(e=this.controller.getSeekTime(e,this.player.duration)),this.player.currentTime=e,this.controller.seek(),this}},{key:"volume",value:function(e){return this.player.volumeLevel=e,this.controller.setVolumeLevel(),this}},{key:"play",value:function(){return this.paused&&this.controller.playOrPause(),this}},{key:"pause",value:function(){return this.paused||this.controller.playOrPause(),this}},{key:"mute",value:function(){return!1===this.muted&&this.controller.muteOrUnmute(),this}},{key:"unmute",value:function(){return!0===this.muted&&this.controller.muteOrUnmute(),this}},{key:"subtitle",value:function(t){var r=this,e=new chrome.cast.media.EditTracksInfoRequest([t]);cast.framework.CastContext.getInstance().getCurrentSession().getSessionObj().media[0].editTracksInfo(e,function(){for(var e in r.subtitles)delete r.subtitles[e].active,e==t&&(r.subtitles[e].active=!0);return r},function(e){r.trigger("error",e)})}},{key:"disconnect",value:function(){return cast.framework.CastContext.getInstance().endCurrentSession(!0),this.controller.stop(),this.session=!1,this.source=null,this.title=null,this.description=null,this.poster=null,this.subtitles=[],this.volumeLevel=1,this.muted=!1,this.paused=!1,this.time=0,this.timePretty="00:00:00",this.duration=0,this.durationPretty="00:00:00",this.progress=0,this.state="disconnected",this.trigger("disconnect"),this}}]),s}();
